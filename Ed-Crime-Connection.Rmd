---
title: "The Education-Crime Connection"
subtitle: "A Data-Driven Analysis of the Philadelphia Public School System and Crime Rates"
author:
- Liam Smith
- Tyler Christianson
- Mitch Jeter
date: "March 2nd, 2025"
output:
  pdf_document:
    toc: true
    toc_depth: '4'
    number_sections: true
  html_document:
    code_folding: show
    highlight: haddock
    number_sections: true
    theme: lumen
    toc: true
    toc_depth: 4
    toc_float: true
urlcolor: blue
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results = "hide", fig.width=8, fig.height=4)
options(scipen = 0, digits = 3)  # controls base R output
if(!require('pacman')) {install.packages('pacman')}
pacman::p_load(dplyr, ggmap, ggplot2, sf, mapview, knitr, lubridate)
```

```{r data load}
neighborhoods <- st_read('data/philadelphia-neighborhoods.geojson') %>% 
  st_transform(4326)
crime <- read.csv('data/crime-by-neighborhood.csv')
schools <- read.csv('data/school_data.csv')
```

\pagebreak

# Executive Summary

## Goal of the Study
The primary objective of this project is to explore and understand the relationship between the Philadelphia Public Schooling System and crime rates in the city of Philadelphia. The relationship between education and crime has long been a topic of interest for policymakers and researchers, as strong education systems are often associated with lower crime rates. This project aims to analyze the connection between the public school system and crime rates across the city, exploring how factors such as graduation rates influence crime patterns. By leveraging records from 2023 and various statistical and machine learning methods, this study seeks to uncover potential relationships and provide insights that could inform policy decisions geared towards improving both education and public safety in the city of Philadelphia.

Through data-driven analysis, this project will look into specific neighborhoods and evaluate the relationship between crime rates and the quality of public schools in the area. By identifying factors that contribute to this relationship, this study can serve as a potential foundation for discussions on how investments in education can serve as a proactive step towards crime prevention. 

## Data description

### OpenData Philly - Uncleaned Datasets

#### Crime Incidents Data
The Philadelphia Police Department provides and maintains a dataset of crime incidents in the city of Philadelphia going back to 2006. The dataset contains key information about each incident, including the police district it occured in, the date and time an officer was dispatched to the scene, the block that the incident occured on, and the type of crime that was committed. For the purposes of this study, the only year used was 2023.

#### School Department of Philadelphia Data
The School District of Philadelphia provides a variety of datasets regarding school performance. This study is based on the School Graduation Rates dataset, which is a longitudinal dataset containing the graduation rate by school broken out by graduation rate type, demographic category, and ninth grade cohort. Students are attributed to the last school that they attended if they did attend multiple schools. For the purposes of this study, the cohort that started high school in 2019 was used.

#### Neighborhood GeoJSON Data
The city of Philadelphia provides neighborhood boundaries for over 150 neighborhoods in the city. This dataset will be used for mapping and also for grouping schools and crime incidents by neighborhood.

### Team One Data - Cleaned Datasets

#### Crime Incidents by Neighborhood
This dataset contains crime incident records from 2023 categorized by neighborhood. It includes 162,032 entries, with attributes such as the date and time of the incident, crime classification, location details, and associated neighborhood. The dataset also includes unique identifiers, district and police service area, and geospatial information. This dataset will be used for analyzing crime trends, spatial distributions, and temporal patterns across neighborhoods.

#### School Data
This dataset contains information on school performance metrics for 79 schools. Each entry includes details such as the school year, unique school identifier, school name, and sector (sector, e.g., district or charter). It focuses on four year graduation rates. The dataset also includes numerical values for assessment, as well as geographical coordinates for spatial analysis. This dataset is useful for evaluating school performance trends and comparing graduation rates across different student populations.

# Exploratory data analysis (EDA)

## Exploring Philadelphia

Philadelphia, the largest city in Pennsylvania and the sixth-largest in the United States, is a historic and cultural hub known for its rich colonial heritage and vibrant modern identity. Founded in 1682 by William Penn, the city played a crucial role in the American Revolution and served as the nation's capital before Washington, D.C. Landmarks such as Independence Hall, where the Declaration of Independence and the U.S. Constitution were signed, and the Liberty Bell symbolize Philadelphia’s deep-rooted connection to American democracy. Beyond its historical significance, the city boasts world-class museums, including the Philadelphia Museum of Art — home to the famous “Rocky Steps” — as well as a thriving arts, music, and culinary scene that attracts millions of visitors each year.

Today, Philadelphia is a dynamic metropolis that balances tradition with innovation. It is home to leading universities such as the University of Pennsylvania and Temple University, contributing to its reputation as an educational and research powerhouse. The city’s economy is diverse, with strong sectors in healthcare, finance, and technology, alongside a passionate sports culture represented by teams like the Eagles, Phillies, Flyers, and 76ers. However, Philadelphia also faces challenges, including socioeconomic disparities, crime, and education system concerns. Despite these issues, the city remains resilient, with ongoing efforts to foster economic growth, community development, and urban revitalization, making it a place of both historical pride and modern ambition.

The city of Philadelphia is home to 159 neighborhoods, the boundaries of which can be seen as shown here :
```{r}
# Set up base map
API_key <- "e1f47dec-6863-4a61-b2cd-e1a5185301b4"
register_stadiamaps(API_key)
phl_map <- get_stadiamap(c(bottom = 39.85, top = 40.14, left = -75.3, right = -74.9), zoom = 12,
                         maptype = 'stamen_toner_lite')
```

```{r, fig.show='hold', message = FALSE, warning = FALSE}
ggmap(phl_map) +
  geom_sf(data = neighborhoods, inherit.aes = FALSE, color = 'black', fill = 'lightblue') +
  theme_minimal() +
  theme(axis.title = element_blank(), axis.text = element_blank(), axis.ticks = element_blank())
```

This map will serve as a foundation for this project and the following exploratory data analysis. By undertsanding the city's geographic layout and distribution of neighborhood, we can better examine how our factors differ across neighborhoods. 

## Exploring Crime

Philadelphia has long faced challenges with crime, making public safety a key concern for residents and city officials alike. The Philadelphia Police Department (PPD), one of the oldest municipal police forces in the United States, is responsible for maintaining law and order across the city's diverse neighborhoods. Crime rates in Philadelphia have fluctuated over the years, with violent crime, particularly gun violence, being a persistent issue in certain areas. Factors such as socioeconomic conditions, education, and policing strategies all play a role in shaping crime trends throughout the city. While initiatives like community policing and crime prevention programs aim to reduce criminal activity, disparities in crime rates across neighborhoods highlight the need for a data-driven approach to understanding and addressing public safety concerns.

Crime incidents are categorized two different ways by the city of Philadelphia: Part 1 and Part 2. Part 1 crimes are more serious offenses. Part 1 crimes are as follows: Homicide (Criminal), Homicide (Justifiable), Homicide (Gross Negligence), Rape, Robbery Firearm, Robbery No Firearm, Aggravated Assault Firearm, Aggravated Assault No Firearm, Burglary Non-Residential, Burglary Residential, Theft from Vehicle, Retail Theft, Motor Vehicle Theft, and Recovered Stolen Motor Vehicle. Part 2 crimes are less serious offenses. Part 2 crimes are as follows: Other Assaults, Arson, Forgery and Counterfeiting, Fraud, Embezzlement, Recieving Stolen Property, Vandalism/Criminal Mischief, Weapon Violations, Prostitution and Commericalized Vice, Other Sex Offenses, Narcotic/Drug Law Violations, Gambling Violations, Offenses Against Family and Children, DUI, Liquor Law Violations, Drunkenness, Disorderly Conduct, Vagrancy, and All Other Offenses. The top five most commited crimes by Part are as follows: 
```{r}
top_5_p1 <- crime %>% 
              filter(ucr_general %in% c('100', '200', '300', '400', '600', '700')) %>%
              count(text_general_code) %>%
              arrange(desc(n)) %>%
              head(5)

table1 <- kable(top_5_p1, caption = "Most Committed Part 1 Crimes", col.names = c('Crime', 'Count')) 

top_5_p2 <- crime %>% 
              filter(ucr_general %in% c('800', '900', '1000', '1100', '1200', '1300', '1400', '1500', 
                                        '1600', '1700', '1800', '1900', '2000', '2100', '2200', '2300', 
                                        '2400', '2500', '2600')) %>%
              count(text_general_code) %>%
              arrange(desc(n)) %>%
              head(5)

table2 <- kable(top_5_p2, caption = "Most Committed Part 2 Crimes", col.names = c('Crime', 'Count'))
```

```{r set up tables, echo = FALSE, results = 'asis'}
table1

table2
```

Crime rates often experience a noticeable increase during the summer months, a trend observed in many cities, including Philadelphia. Several factors contribute to this seasonal spike, including warmer weather, longer daylight hours, and increased social interactions, all of which create more opportunities for criminal activity. Schools being out of session can also lead to higher rates of juvenile crime, as young individuals have more free time and fewer structured activities. Additionally, heat has been linked to increased aggression and heightened tensions, which can escalate conflicts and contribute to violent crimes. Law enforcement agencies often anticipate these seasonal fluctuations and may adjust their patrols and crime prevention strategies accordingly to mitigate the surge in incidents. Philadelphia's number of crimes by month in 2023 is shown here :

```{r}
inc_by_month <- crime %>% 
  group_by(month = month(dispatch_date_time)) %>% 
  summarise(n = n()) %>% 
  arrange(month) %>% 
  mutate(month = factor(month, levels = 1:12, labels = month.name))
```

```{r, fig.show='hold', message = FALSE, warning = FALSE}
ggplot(inc_by_month, aes(x = month, y = n)) +
  geom_col(fill = 'lightblue', color = 'black') +
  labs(title = 'Crime Incidents by Month', y = 'Count', x = NULL) +
  theme_minimal()
```

Crime in Philadelphia varies significantly by neighborhood, reflecting differences in socioeconomic conditions, population density, and law enforcement presence. Certain areas, such as Kensington and North Philadelphia, experience higher crime rates, particularly violent crimes, due to factors like poverty, drug activity, and gang presence. In contrast, neighborhoods like Center City and parts of South Philadelphia, while still experiencing crime, tend to have lower rates of violent offenses and more incidents related to property crime or minor offenses. The distribution of crime is also influenced by factors such as proximity to major transit hubs, nightlife areas, and community investment in safety initiatives. Understanding crime patterns at the neighborhood level is crucial for law enforcement, policymakers, and community organizations to develop targeted strategies for crime prevention and public safety improvements. The top ten neighborhoods by total crime incidents are as follows:

```{r}
inc_by_neighborhood <- crime %>% 
  group_by(LISTNAME) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n))
```

```{r, echo = FALSE, results = 'asis'}
kable(inc_by_neighborhood[1:10,], caption = "Top 10 Neighborhoods by Crime Incidents", col.names = c('Neighborhood', 'Count'))
```

And a crime heatmap can be seen here:

```{r}
# Merge crime counts with spacial neighborhood data
neighborhoods_crime <- neighborhoods %>% 
  left_join(inc_by_neighborhood, by = c('LISTNAME' = 'LISTNAME'))

# Convert to df for plot
neighborhoods_crime_df <- fortify(neighborhoods_crime, region = 'Name')
```


```{r, fig.show='hold', message = FALSE, warning = FALSE}
ggplot(data = neighborhoods_crime) +
  geom_sf(data = neighborhoods_crime, aes(fill = n), color = 'black') +
  scale_fill_viridis_c(option = 'magma', na.value = 'gray90') +
  labs(title = 'Crime Heatmap by Neighborhood', fill = 'Count') +
  theme_minimal()
```



## Exploring Schools

The School District of Philadelphia (SDP) is the largest public school system in Pennsylvania, serving over 200,000 students across a diverse and dynamic urban landscape. With a mix of traditional public schools, charter schools, and specialized programs, the district plays a crucial role in shaping educational opportunities for children in the city. However, SDP has long faced challenges related to funding disparities, aging infrastructure, and achievement gaps among students from different socioeconomic backgrounds. Despite these obstacles, the district continues to implement reforms aimed at improving academic performance, increasing graduation rates, and expanding access to quality education. As education is closely linked to broader social and economic outcomes, understanding the strengths and struggles of Philadelphia’s public schools is essential in analyzing larger community trends, including crime and economic mobility.

\pagebreak
# Appendix {-}

## Data dictionary

A detailed summary of the variables in each data set follows:

### OpenData Philly - Uncleaned Datasets

#### Crime Incidents \newline

*Source:* https://metadata.phila.gov/#home/datasetdetails/5543868920583086178c4f8e/representationdetails/570e7621c03327dc14f4b68d/?view_287_page=1 

*Description:* Part 1 & Part 2 Crime Incidents from the Police Department's INCT system with generalized UCR codes and addresses rounded to the hundred block. These counts may not coincide exactly with data that is submitted to the Uniformed Crime Reporting (UCR) system.

* the_geom - Unique identifier
* cartodb_id - Unique identifier
* the_geom_webmercator - Unique identifier
* objectid - Unique identifier
* dc_dist - A two character field that names the District boundary
* psa - A single character field that names the Police Service Area Boundary
* dispatch_date_time - The date and time that the officer was dispatched to the scene
* dispatch_date - Dispatch date formatted as a string
* dispatch_time - Dispatch time formatted as a string
* hour_ - The generalized hour of the dispatched time
* dc_key - The unique identifier of the crime that consists of Year + District + Unique ID
* location_block - The location of crime generalized by street block
* ucr_general - The rounded crime code
* text_general_code - The generalized text for the crime code
* point_x - Longitude of crime location
* point_y - Latitude of crime location
* lat - Latitude of crime location
* lng - Longitude of crime location

#### School Department of Philadelphia \newline

*Source:* https://www.philasd.org/research/#opendata

*Description:* This longitudinal open data file includes information about the graduation rates for schools broken out by: graduation rate type (four-year, five-year, or six-year), demographic category (EL status, IEP status, Economically Disadvantaged Status, Gender, or Ethnicity), and 9th grade cohort. Students are attributed to the last school at which they actively attended in the respective graduation window, which ends on September 30 each year. Students are classified as EL, as having an IEP, and/or economically disadvantaged if they were designated as such at any point during their high school career.

* cohort - School year that freshman began
* schoolid_ulcs - Unique school identifier
* school_name - School name
* sector - Type of school (Two levels - District and Alternative)
* rate_type - Graduation rate type
* group - Grouping of students
* subgroup - Subgrouping of students
* denom - Number of students in cohort
* num - Number of students that graduated in cohort
* score - Percentage of students that graduated in cohort
* lat - Latitude of school location
* long - Longitude of crime location

#### Neighborhood GeoJSON \newline

*Source:* https://opendataphilly.org/datasets/philadelphia-neighborhoods/

*Description:* This dataset includes neighborhood boundaries for 150+ neighborhoods in Philadelphia. The data was gathered from a mix of publicly available maps, including from the City of Philadelphia, the City Archives, the Philadelphia Inquirer, and user feedback.

* NAME - Neighborhood name
* LISTNAME - Neighborhood name
* MAPNAME - Neighborhood name
* Shape_Leng - Length of shape of neighborhood boundary
* Shape_Area - Total area inside shape of neighborhood
* geometry - Polygon coordinates of neighborhood boundary

### Team One Data - Cleaned Datasets

#### Crime Incidents by Neighborhood \newline

*Description:* This clean dataset contains crime incident records from 2023 categorized by neighborhood, including details on crime type, date, location, and police district, making it useful for analyzing spatial and temporal crime patterns.

* the_geom - Unique identifier
* cartodb_id - Unique identifier
* the_geom_webmercator - Unique identifier
* objectid - Unique identifier
* dc_dist - A two character field that names the District boundary
* psa - A single character field that names the Police Service Area Boundary
* dispatch_date_time - The date and time that the officer was dispatched to the scene
* dispatch_date - Dispatch date formatted as a string
* dispatch_time - Dispatch time formatted as a string
* hour_ - The generalized hour of the dispatched time
* dc_key - The unique identifier of the crime that consists of Year + District + Unique ID
* location_block - The location of crime generalized by street block
* ucr_general - The rounded crime code
* text_general_code - The generalized text for the crime code
* point_x - Longitude of crime location
* point_y - Latitude of crime location
* NAME - Neighborhood name
* LISTNAME - Neighborhood name
* MAPNAME - Neighborhood name
* Shape_Leng - Length of shape of neighborhood boundary
* Shape_Area - Total area inside shape of neighborhood
* geometry - Polygon coordinates of neighborhood boundary


#### School Data \newline

*Description:* This clean dataset contains school performance metrics from 2023, including four year graduation rates by school, sector, and demographic group, along with geographical coordinates for spatial analysis.

* cohort - School year that freshman began
* schoolid_ulcs - Unique school identifier
* school_name - School name
* sector - Type of school (Two levels - District and Alternative)
* rate_type - Graduation rate type
* group - Grouping of students
* subgroup - Subgrouping of students
* denom - Number of students in cohort
* num - Number of students that graduated in cohort
* score - Percentage of students that graduated in cohort
* lat - Latitude of school location
* long - Longitude of crime location

## Data Prep for EDA

The type of crime is very important for grouping incidents. UCR code is grouped as a factor for easier analysis.

```{r}
# Convert crime code to factor
crime <- crime %>% 
  mutate(ucr_general = as.factor(ucr_general))
```

## Data cleaning process

### Putting crime incidents into neighborhoods

In order to analyze crime incidents by neighborhood, we needed to spatially join the crime incidents data with the neighborhood boundaries. This was done using the `sf` package in R. The process involved reading in the neighborhood boundaries and crime incidents data, converting the crime incidents to spatial points, and then performing a spatial join to assign each crime incident to a neighborhood. The resulting dataset was then saved as a new CSV file for further analysis.

```{r, echo=TRUE, eval=FALSE}
# Load in data
neighborhood <- st_read('data/philadelphia-neighborhoods.geojson')
crime <- read.csv('data/crime-incidents-2023.csv')

# Filter out missing coordinates in crime
crime <- crime %>% filter(!is.na(lat) & !is.na(lng))

# Convert crime to sf
crime_sf <- st_as_sf(crime, coords = c('lng', 'lat'), crs = 4326)

# Make sure both have same CRS
neighborhood <- st_make_valid(neighborhood)

# Simplify geometries
neighborhood <- st_simplify(neighborhood, dTolerance = 0.001)

# Spatial join to get neighborhood for each crime
crime_w_neighborhoods <- st_join(crime_sf, neighborhood, join = st_intersects)

# Save to a new csv
#write.csv(crime_w_neighborhoods, 'data/crime-by-neighborhood.csv')
```

### Combining school coordinates with graduation rates

In order to begin working with the school data, we had to combine the school coordinates with the graduation rates. This was done by reading in the school list and graduation rates data, joining them on the school ID, and then splitting the GPS coordinates into separate latitude and longitude columns. Also, given time constraints on this project, the dataset was reduced to only include four year graduation rates. The resulting dataset was then saved as a new CSV file for further analysis.

```{r, echo=TRUE, eval=FALSE}
# Load in files we need
grad_rates <- read.csv('data/SDP_Graduation_rates_school_S_2024-04-01.csv')
school_list <- read.csv('data/2022-2023 Master SChool List (20230110).csv')

# First, let's clean up the graduation rates
# We only want the graduating class of 2023, 4 year grad rates, for all students
grad_rates <- grad_rates %>% 
  filter(cohort == '2019-2020',
         rate_type == '4-Year Graduation Rate',
         group == 'All Students')

# Next let's bring in the latitude and longitude from the school list
school_data <- grad_rates %>% 
  left_join(school_list %>% select('ULCS.Code', 'GPS.Location'),
            by = c('schoolid_ulcs' = 'ULCS.Code'))

# Split up GPS into lat and long
school_data <- school_data %>% 
  separate(GPS.Location, c('lat', 'long'), sep = ', ', convert = TRUE)
           
# Drop empty coordinate
school_data <- school_data %>% 
  filter(!is.na(lat))
           
# Save as csv
#write.csv(school_data, 'data/school_data.csv', row.names = FALSE)
```

